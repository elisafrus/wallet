name: Continuous Integration

on:
  pull_request: # Запускати при створенні або оновленні PR
    branches: [main, master]
  push: # Запускати при коміті безпосередньо у гілку
    branches: [main, master]

jobs:
  build-and-test:
    runs-on: ubuntu-latest # Використовуємо віртуальну машину Ubuntu

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          # Для коректної перевірки commit history (Conventional Commits)
          fetch-depth: 0

      - name: Set up Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Використовуйте версію Node.js вашого проєкту

      - name: Install Dependencies
        # Додавання --frozen-lockfile гарантує встановлення точних версій
        run: npm ci

      # ---------------------------------------------
      # 1. Перевірка форматування (Prettier)
      # ---------------------------------------------
      - name: Check Code Formatting
        # Рекомендується створити скрипт у package.json, наприклад: "format:check": "prettier --check ."
        run: npx prettier --check .
        # АБО: run: npm run format:check (Якщо створили скрипт)

      # ---------------------------------------------
      # 2. Перевірка Лінтінгу (ESLint)
      # ---------------------------------------------
      - name: Lint and Static Analysis (ESLint)
        # Використовуємо 'npm run lint', що є найбільш надійним способом запуску
        run: npm run lint

      # ---------------------------------------------
      # 3. Перевірка Збірки/Компіляції (""Збирається-билдиться"")
      # ---------------------------------------------
      - name: Run Build (Placeholder)
        # Використовуємо скрипт 'npm run build'
        run: npm run build

      # ---------------------------------------------
      # 4. Запуск Тестів
      # ---------------------------------------------
      - name: Run Tests (Unit/Integration)
        # Використовуємо скрипт 'npm run test'
        run: npm run test

      # ---------------------------------------------
      # 5. Перевірка стилю комітів (Conventional Commits)
      # ---------------------------------------------
      - name: Validate Commit Messages
        uses: wagoid/commitlint-github-action@v6
        with:
          # Використовує конфігурацію, яку ви маєте для Conventional Commits
          configFile: .commitlintrc.json
